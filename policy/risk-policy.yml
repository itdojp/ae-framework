version: 1
updated_at: "2026-02-26"
owner: "ae-framework"

labels:
  risk:
    low: "risk:low"
    high: "risk:high"
  optional_gates:
    - "run-security"
    - "run-ci-extended"
    - "enforce-artifacts"
    - "enforce-testing"
    - "enforce-context-pack"

required_checks:
  - "verify-lite"
  # 新運用（Risk policy enforced gate）
  # policy-gate 自体は required check だが、自己参照を避けるため script 側で除外して評価する
  - "policy-gate"

high_risk:
  min_human_approvals: 1
  require_policy_labels: true
  fail_when_required_gate_is_pending: false

low_risk:
  allow_auto_merge: true
  require_human_approval: false

classification:
  high_risk_paths:
    - ".github/workflows/**"
    - "policy/release-policy.yml"
    - "infra/**"
    - "terraform/**"
    - "k8s/**"
    - "ansible/**"
    - "db/migrations/**"
    - "schema/**"
    - "auth/**"
    - "security/**"
    - "config/**"
  force_high_risk_when:
    - "contains_dependency_manifest_change"
    - "contains_external_interface_change"
    - "contains_context_boundary_change"

label_requirements:
  - id: "dependency-supply-chain"
    when_any_changed:
      - "package.json"
      - "**/package.json"
      - "pnpm-lock.yaml"
      - "**/pnpm-lock.yaml"
      - "package-lock.json"
      - "**/package-lock.json"
      - "yarn.lock"
      - "**/yarn.lock"
      - "go.mod"
      - "**/go.mod"
      - "go.sum"
      - "**/go.sum"
      - "requirements*.txt"
      - "**/requirements*.txt"
      - "poetry.lock"
      - "**/poetry.lock"
      - "Gemfile.lock"
      - "**/Gemfile.lock"
      - "composer.lock"
      - "**/composer.lock"
    require_labels:
      - "run-security"
  - id: "external-interface"
    when_any_changed:
      - "api/**"
      - "contracts/**"
      - "schema/**"
      - "spec/**"
      - "openapi/**"
    require_labels:
      - "run-ci-extended"
      - "enforce-artifacts"
  - id: "testing-reproducibility"
    when_any_changed:
      - "tests/**"
      - "scripts/testing/**"
      - "scripts/replay/**"
      - ".github/workflows/testing-ddd-scripts.yml"
    require_labels:
      - "enforce-testing"
  - id: "context-pack-boundary"
    when_any_changed:
      - "spec/context-pack/**"
      - "configs/context-pack/**"
      - "scripts/context-pack/**"
      - ".github/workflows/context-pack-quality-gate.yml"
    require_labels:
      - "enforce-context-pack"

gate_checks:
  run-security:
    - "Security Scanning"
  run-ci-extended:
    - "CI Extended (entry: pr/push) / extended"
    - "extended"
    - "Parallel Tests (entry: pr/push) / Test Suite (integration)"
  enforce-artifacts:
    - "validate-artifacts / validate"
    - "*validate-artifacts*validate*"
  enforce-testing:
    - "testing-ddd"
  enforce-context-pack:
    - "context-pack-e2e"
