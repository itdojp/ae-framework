# Centralized Quality Gates System

> **üåç Language / Ë®ÄË™û**: [English](#english) | [Êó•Êú¨Ë™û](#japanese)

---

## English

**Comprehensive centralized quality gates system ensuring consistent quality standards across all development phases and environments**

The AE-Framework implements a comprehensive centralized quality gates system that ensures consistent quality standards across all development phases and environments.

## Overview

The centralized quality gates system provides:

- **Single Source of Truth**: All quality thresholds defined in one JSON configuration file
- **Environment-Specific Overrides**: Different standards for development, CI, and production
- **Phase-Aware Enforcement**: Quality gates activate based on development phase progression
- **Automated CI/CD Integration**: GitHub Actions workflows enforce quality standards
- **Flexible Configuration**: Easy to modify thresholds and add new quality gates

## Architecture

### Core Components

```
policy/
‚îú‚îÄ‚îÄ quality.json              # Centralized policy configuration
src/utils/
‚îú‚îÄ‚îÄ quality-policy-loader.ts  # TypeScript utility for loading policy
scripts/
‚îú‚îÄ‚îÄ run-quality-gates.cjs     # Main quality gate runner
‚îú‚îÄ‚îÄ check-a11y-threshold.cjs  # Accessibility checker (updated)
‚îú‚îÄ‚îÄ check-coverage-threshold.cjs # Coverage checker (new)
.github/workflows/
‚îú‚îÄ‚îÄ quality-gates-centralized.yml # Comprehensive CI workflow
‚îî‚îÄ‚îÄ phase6-validation.yml     # Updated to use centralized policy
```

### Policy Configuration Structure

The centralized policy (`policy/quality.json`) defines:

1. **Quality Gates**: Each gate has thresholds, enforcement level, applicable phases, and tools
2. **Environment Overrides**: Specific adjustments for dev/CI/production environments  
3. **Reporting Configuration**: Output formats, retention, and notification settings
4. **Tool Integration**: Configuration for external tools like Lighthouse CI

## Configuration

### Quality Gates Definition

Each quality gate is defined with:

```json
{
  "gateName": {
    "description": "Human-readable description",
    "enforcement": "strict|warn|off",
    "thresholds": {
      "metricName": value
    },
    "tools": ["tool1", "tool2"],
    "phases": ["phase-3", "phase-6"],
    "enabledFromPhase": "phase-3",
    "excludePatterns": ["**/*.d.ts"]
  }
}
```

### Supported Quality Gates

| Gate | Description | Key Metrics | Phases |
|------|-------------|-------------|---------|
| **accessibility** | A11y compliance | critical‚â§0, warnings‚â§5 | phase-6 |
| **coverage** | Code coverage | lines‚â•80%, functions‚â•80% | phase-3+ |
| **lighthouse** | Performance & quality | performance‚â•90, a11y‚â•95 | phase-6 |
| **linting** | Code quality & style | errors‚â§0, warnings‚â§10 | all |
| **security** | Vulnerability scan | critical‚â§0, high‚â§0 | phase-4+ |
| **tdd** | Test-driven development | ratio‚â•1.2, compliance‚â•100% | phase-3+ |
| **visual** | Visual regression | pixelDiff‚â§0.02 | phase-6 |
| **policy** | OPA compliance | violations‚â§0 | phase-6 |
| **mutation** | Mutation testing | score‚â•70% | phase-4+ |

### Environment Overrides

#### Development Environment
- Relaxed thresholds for faster iteration
- Warnings instead of strict enforcement
- Some gates disabled (lighthouse, visual)

#### CI Environment  
- Standard enforcement levels
- All applicable gates enabled
- Balanced between quality and build speed

#### Production Environment
- Strictest thresholds
- Zero tolerance for critical issues
- Enhanced security and performance requirements

## Usage

### Command Line Interface

#### Basic Usage
```bash
# Run all applicable quality gates for current phase
npm run quality:gates

# Run with specific environment
npm run quality:gates:dev
npm run quality:gates:prod

# Run specific gates only
npm run quality:accessibility
npm run quality:coverage

# Run comprehensive quality check
npm run quality:all
```

#### Advanced Usage
```bash
# Custom environment and phase
node scripts/run-quality-gates.cjs --env=production --phase=phase-6

# Specific gate combination
node scripts/run-quality-gates.cjs --gates=accessibility,coverage,lighthouse

# Help and options
node scripts/run-quality-gates.cjs --help
```

### TypeScript Integration

```typescript
import { 
  loadQualityPolicy, 
  getQualityGate, 
  shouldEnforceGate,
  validateQualityResults 
} from '../src/utils/quality-policy-loader.js';

// Load policy with environment overrides
const policy = loadQualityPolicy('ci');

// Get specific gate configuration  
const accessibilityGate = getQualityGate('accessibility', 'ci');

// Check if gate should be enforced
const shouldCheck = shouldEnforceGate('accessibility', 'phase-6', 'ci');

// Validate results against thresholds
const validation = validateQualityResults('accessibility', {
  critical: 0,
  serious: 1,
  moderate: 2
}, 'ci');
```

### GitHub Actions Integration

The system automatically integrates with GitHub Actions:

```yaml
# Use the centralized quality gates workflow
name: Quality Check
on: [push, pull_request]

jobs:
  quality:
    uses: ./.github/workflows/quality-gates-centralized.yml
    with:
      environment: 'ci'
      phase: 'auto-detect'
      gates: 'all'
```

## Implementation Details

### Policy Loading and Overrides

The policy loader applies environment-specific overrides using a dot-notation path system:

```json
{
  "environments": {
    "development": {
      "overrides": {
        "accessibility.thresholds.total_warnings": 10,
        "coverage.enforcement": "warn"
      }
    }
  }
}
```

### Phase-Aware Enforcement

Quality gates can be configured to:
1. Apply to specific phases: `"phases": ["phase-6"]`
2. Enable from a certain phase onward: `"enabledFromPhase": "phase-3"`
3. Always apply if no phase restrictions are defined

### Tool Integration

#### Lighthouse CI
- Dynamic configuration based on policy thresholds  
- Environment-aware assertion levels
- Automatic score conversion (90 ‚Üí 0.9)

#### Coverage Tools
- Support for both nyc and vitest coverage
- Configurable exclude patterns
- Multiple metric types (lines, functions, branches, statements)

#### Accessibility Testing
- Integration with jest-axe and axe-core
- Multi-level violation tracking
- Detailed failure reporting

### Error Handling and Fallbacks

The system includes robust error handling:

1. **Policy Loading Failures**: Falls back to CLI arguments or defaults
2. **Tool Unavailability**: Skips gates for missing tools with warnings
3. **Report Generation**: Creates empty reports for development environments
4. **Environment Detection**: Auto-detects environment from NODE_ENV

## Customization

### Adding New Quality Gates

1. **Update Policy Configuration**:
```json
{
  "quality": {
    "myCustomGate": {
      "description": "Custom quality gate",
      "enforcement": "strict",
      "thresholds": {
        "customMetric": 90
      },
      "tools": ["custom-tool"],
      "phases": ["phase-4", "phase-5", "phase-6"]
    }
  }
}
```

2. **Implement Gate Runner**:
```javascript
// In scripts/run-quality-gates.cjs
case 'myCustomGate':
  command = 'npm run custom-check';
  break;
```

3. **Add NPM Script**:
```json
{
  "scripts": {
    "quality:custom": "node scripts/run-quality-gates.cjs --gates=myCustomGate"
  }
}
```

### Modifying Thresholds

Simply update the `policy/quality.json` file:

```json
{
  "quality": {
    "coverage": {
      "thresholds": {
        "lines": 85,        // Changed from 80
        "functions": 85     // Changed from 80  
      }
    }
  }
}
```

All tools and workflows will automatically use the new thresholds.

### Environment-Specific Adjustments

Add or modify environment overrides:

```json
{
  "environments": {
    "staging": {
      "description": "Staging environment",
      "overrides": {
        "lighthouse.thresholds.performance": 85,
        "accessibility.enforcement": "warn"
      }
    }
  }
}
```

## Best Practices

### Policy Management
1. **Version Control**: Always version control the policy file
2. **Change Reviews**: Require approval for threshold changes
3. **Documentation**: Document rationale for threshold values
4. **Gradual Changes**: Implement threshold increases gradually

### Development Workflow
1. **Pre-commit**: Run quality gates before committing
2. **Local Testing**: Use development environment for iteration
3. **Phase Awareness**: Understand which gates apply to your current phase
4. **Continuous Monitoring**: Regular quality gate execution

### CI/CD Integration
1. **Matrix Strategy**: Parallel execution for faster feedback
2. **Artifact Collection**: Preserve reports for analysis
3. **Failure Handling**: Appropriate fail-fast vs. continue-on-error
4. **PR Comments**: Automated feedback on pull requests

## Troubleshooting

### Common Issues

#### Policy Loading Failures
```bash
‚ö†Ô∏è  Could not load quality policy: ENOENT: no such file or directory
```
**Solution**: Ensure `policy/quality.json` exists and is valid JSON.

#### Phase Detection Problems
```bash
‚ö†Ô∏è  Could not detect current phase, using phase-1
```
**Solution**: Create `.ae/phase-state.json` or specify phase explicitly:
```bash
node scripts/run-quality-gates.cjs --phase=phase-6
```

#### Tool Unavailability
```bash
‚ö†Ô∏è  Lighthouse CI config not found, skipping
```
**Solution**: Install required tools or configure gate as optional.

### Debug Mode

Enable verbose logging for troubleshooting:

```bash
DEBUG=quality-gates node scripts/run-quality-gates.cjs --env=development
```

### Manual Threshold Validation

Test specific thresholds without running full quality gates:

```bash
# Check accessibility only
node scripts/check-a11y-threshold.cjs --env=development

# Check coverage only  
node scripts/check-coverage-threshold.cjs --env=ci
```

## Migration Guide

### From Hardcoded Thresholds

1. **Identify Current Thresholds**: Review existing scripts and workflows
2. **Update Policy File**: Add current values to `policy/quality.json`
3. **Update Scripts**: Modify to use centralized policy loader
4. **Test Migration**: Verify same behavior with new system
5. **Cleanup**: Remove hardcoded values from scripts

### From Multiple Configuration Files

1. **Consolidate Configurations**: Merge threshold values into single policy
2. **Update Tool Configs**: Modify tools to read from centralized policy
3. **Environment Mapping**: Map existing environment-specific configs
4. **Validation**: Ensure all scenarios still work correctly

## Advanced Features

### Conditional Enforcement

Gates can be conditionally enforced based on:
- File changes (via GitHub Actions path filters)
- Environment variables
- Development phase progression
- Custom business logic

### Reporting Integration

The system supports multiple reporting formats:
- JSON for programmatic consumption
- HTML for human-readable reports  
- JUnit XML for CI/CD integration
- Custom formats via plugins

### Notification System

Configure notifications for:
- Quality gate failures
- Threshold changes requiring approval
- Trend analysis and degradation alerts

This centralized quality gates system provides a robust foundation for maintaining consistent code quality across the entire AE-Framework development lifecycle.

---

## Japanese

**ÂÖ®ÈñãÁô∫„Éï„Çß„Éº„Ç∫„Å®Áí∞Â¢É„Å´„Åä„ÅÑ„Å¶‰∏ÄË≤´„Åó„ÅüÂìÅË≥™Âü∫Ê∫ñ„Çí‰øùË®º„Åô„ÇãÂåÖÊã¨ÁöÑ„Å™ÈõÜÁ¥ÑÂìÅË≥™„Ç≤„Éº„Éà„Ç∑„Çπ„ÉÜ„É†**

AE-Framework„ÅØ„ÄÅÂÖ®„Å¶„ÅÆÈñãÁô∫„Éï„Çß„Éº„Ç∫„Å®Áí∞Â¢É„Å´„Åä„ÅÑ„Å¶‰∏ÄË≤´„Åó„ÅüÂìÅË≥™Âü∫Ê∫ñ„Çí‰øùË®º„Åô„ÇãÂåÖÊã¨ÁöÑ„Å™ÈõÜÁ¥ÑÂìÅË≥™„Ç≤„Éº„Éà„Ç∑„Çπ„ÉÜ„É†„ÇíÂÆüË£Ö„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

### Ê¶ÇË¶Å

ÈõÜÁ¥ÑÂìÅË≥™„Ç≤„Éº„Éà„Ç∑„Çπ„ÉÜ„É†„ÅØ‰ª•‰∏ã„ÇíÊèê‰æõ„Åó„Åæ„ÅôÔºö

- **Âçò‰∏ÄÊÉÖÂ†±Ê∫ê**: ÂÖ®„Å¶„ÅÆÂìÅË≥™ÈñæÂÄ§„Çí‰∏Ä„Å§„ÅÆJSONË®≠ÂÆö„Éï„Ç°„Ç§„É´„ÅßÂÆöÁæ©
- **Áí∞Â¢ÉÂõ∫Êúâ„ÅÆ„Ç™„Éº„Éê„Éº„É©„Ç§„Éâ**: ÈñãÁô∫„ÄÅCI„ÄÅÊú¨Áï™Áí∞Â¢É„Åß„ÅÆÁï∞„Å™„ÇãÂü∫Ê∫ñ
- **„Éï„Çß„Éº„Ç∫Ë™çË≠ò„ÅÆÂº∑Âà∂**: ÈñãÁô∫„Éï„Çß„Éº„Ç∫„ÅÆÈÄ≤Ë°å„Å´Âü∫„Å•„ÅèÂìÅË≥™„Ç≤„Éº„Éà„ÅÆÊúâÂäπÂåñ
- **Ëá™ÂãïCI/CDÁµ±Âêà**: GitHub Actions„ÉØ„Éº„ÇØ„Éï„É≠„Éº„Å´„Çà„ÇãÂìÅË≥™Âü∫Ê∫ñ„ÅÆÂº∑Âà∂
- **ÊüîËªü„Å™Ë®≠ÂÆö**: ÈñæÂÄ§„ÅÆÂ§âÊõ¥„Å®Êñ∞„Åó„ÅÑÂìÅË≥™„Ç≤„Éº„Éà„ÅÆËøΩÂä†„ÅåÂÆπÊòì

### „Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£

#### „Ç≥„Ç¢„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà

```
policy/
‚îú‚îÄ‚îÄ quality.json              # ÈõÜÁ¥Ñ„Éù„É™„Ç∑„ÉºË®≠ÂÆö
src/utils/
‚îú‚îÄ‚îÄ quality-policy-loader.ts  # „Éù„É™„Ç∑„Éº„É≠„Éº„ÉâÁî®TypeScript„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£
scripts/
‚îú‚îÄ‚îÄ run-quality-gates.cjs     # „É°„Ç§„É≥ÂìÅË≥™„Ç≤„Éº„Éà„É©„É≥„Éä„Éº
‚îú‚îÄ‚îÄ check-a11y-threshold.cjs  # „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£„ÉÅ„Çß„ÉÉ„Ç´„ÉºÔºàÊõ¥Êñ∞Ê∏à„ÅøÔºâ
‚îú‚îÄ‚îÄ check-coverage-threshold.cjs # „Ç´„Éê„É¨„ÉÉ„Ç∏„ÉÅ„Çß„ÉÉ„Ç´„ÉºÔºàÊñ∞Ë¶èÔºâ
.github/workflows/
‚îú‚îÄ‚îÄ quality-gates-centralized.yml # ÂåÖÊã¨ÁöÑCI„ÉØ„Éº„ÇØ„Éï„É≠„Éº
‚îî‚îÄ‚îÄ phase6-validation.yml     # ÈõÜÁ¥Ñ„Éù„É™„Ç∑„Éº‰ΩøÁî®„Å´Êõ¥Êñ∞
```

#### „Éù„É™„Ç∑„ÉºË®≠ÂÆöÊßãÈÄ†

ÈõÜÁ¥Ñ„Éù„É™„Ç∑„ÉºÔºà`policy/quality.json`Ôºâ„ÅØ‰ª•‰∏ã„ÇíÂÆöÁæ©„Åó„Åæ„ÅôÔºö

1. **ÂìÅË≥™„Ç≤„Éº„Éà**: ÂêÑ„Ç≤„Éº„Éà„ÅØÈñæÂÄ§„ÄÅÂº∑Âà∂„É¨„Éô„É´„ÄÅÈÅ©Áî®„Éï„Çß„Éº„Ç∫„ÄÅ„ÉÑ„Éº„É´„ÇíÂê´„ÇÄ
2. **Áí∞Â¢É„Ç™„Éº„Éê„Éº„É©„Ç§„Éâ**: dev/CI/Êú¨Áï™Áí∞Â¢É„Åß„ÅÆÁâπÂÆöË™øÊï¥
3. **„É¨„Éù„Éº„ÉàË®≠ÂÆö**: Âá∫ÂäõÂΩ¢Âºè„ÄÅ‰øùÊåÅÊúüÈñì„ÄÅÈÄöÁü•Ë®≠ÂÆö
4. **„ÉÑ„Éº„É´Áµ±Âêà**: Lighthouse CI„Å™„Å©Â§ñÈÉ®„ÉÑ„Éº„É´„ÅÆË®≠ÂÆö

### Ë®≠ÂÆö

#### ÂìÅË≥™„Ç≤„Éº„ÉàÂÆöÁæ©

ÂêÑÂìÅË≥™„Ç≤„Éº„Éà„ÅØ‰ª•‰∏ã„ÅßÂÆöÁæ©„Åï„Çå„Åæ„ÅôÔºö

```json
{
  "gateName": {
    "description": "‰∫∫ÈñìÂèØË™≠„Å™Ë™¨Êòé",
    "enforcement": "strict|warn|off",
    "thresholds": {
      "metricName": value
    },
    "tools": ["tool1", "tool2"],
    "phases": ["phase-3", "phase-6"],
    "enabledFromPhase": "phase-3",
    "excludePatterns": ["**/*.d.ts"]
  }
}
```

#### „Çµ„Éù„Éº„Éà„Åï„Çå„ÇãÂìÅË≥™„Ç≤„Éº„Éà

| „Ç≤„Éº„Éà | Ë™¨Êòé | ‰∏ªË¶Å„É°„Éà„É™„ÇØ„Çπ | „Éï„Çß„Éº„Ç∫ |
|--------|------|----------------|----------|
| **accessibility** | A11yÊ∫ñÊã† | critical‚â§0, warnings‚â§5 | phase-6 |
| **coverage** | „Ç≥„Éº„Éâ„Ç´„Éê„É¨„ÉÉ„Ç∏ | lines‚â•80%, functions‚â•80% | phase-3+ |
| **lighthouse** | „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉªÂìÅË≥™ | performance‚â•90, a11y‚â•95 | phase-6 |
| **linting** | „Ç≥„Éº„ÉâÂìÅË≥™„Éª„Çπ„Çø„Ç§„É´ | errors‚â§0, warnings‚â§10 | ÂÖ®„Å¶ |
| **security** | ËÑÜÂº±ÊÄß„Çπ„Ç≠„É£„É≥ | critical‚â§0, high‚â§0 | phase-4+ |
| **tdd** | „ÉÜ„Çπ„ÉàÈßÜÂãïÈñãÁô∫ | ratio‚â•1.2, compliance‚â•100% | phase-3+ |
| **visual** | „Éì„Ç∏„É•„Ç¢„É´ÂõûÂ∏∞ | pixelDiff‚â§0.02 | phase-6 |
| **policy** | OPAÊ∫ñÊã† | violations‚â§0 | phase-6 |
| **mutation** | „Éü„É•„Éº„ÉÜ„Éº„Ç∑„Éß„É≥„ÉÜ„Çπ„Éà | score‚â•70% | phase-4+ |

#### Áí∞Â¢É„Ç™„Éº„Éê„Éº„É©„Ç§„Éâ

##### ÈñãÁô∫Áí∞Â¢É
- È´òÈÄüÂèçÂæ©„ÅÆ„Åü„ÇÅ„ÅÆÁ∑©„ÅÑÈñæÂÄ§
- Âé≥Ê†º„Å™Âº∑Âà∂„ÅÆ‰ª£„Çè„Çä„Å´Ë≠¶Âëä
- ‰∏ÄÈÉ®„Ç≤„Éº„Éà„ÅÆÁÑ°ÂäπÂåñÔºàlighthouse„ÄÅvisualÔºâ

##### CIÁí∞Â¢É
- Ê®ôÊ∫ñÂº∑Âà∂„É¨„Éô„É´
- ÈÅ©Áî®ÂèØËÉΩ„Å™ÂÖ®„Ç≤„Éº„ÉàÊúâÂäπ
- ÂìÅË≥™„Å®„Éì„É´„ÉâÈÄüÂ∫¶„ÅÆ„Éê„É©„É≥„Çπ

##### Êú¨Áï™Áí∞Â¢É
- ÊúÄ„ÇÇÂé≥Ê†º„Å™ÈñæÂÄ§
- ÈáçË¶Å„Å™ÂïèÈ°å„Å´ÂØæ„Åô„Çã„Çº„É≠„Éà„É¨„É©„É≥„Çπ
- Âº∑Âåñ„Åï„Çå„Åü„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Å®„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπË¶Å‰ª∂

### ‰ΩøÁî®ÊñπÊ≥ï

#### „Ç≥„Éû„É≥„Éâ„É©„Ç§„É≥„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ

##### Âü∫Êú¨‰ΩøÁî®Ê≥ï
```bash
# ÁèæÂú®„ÅÆ„Éï„Çß„Éº„Ç∫„Å´ÈÅ©Áî®ÂèØËÉΩ„Å™ÂÖ®ÂìÅË≥™„Ç≤„Éº„Éà„ÇíÂÆüË°å
npm run quality:gates

# ÁâπÂÆöÁí∞Â¢É„ÅßÂÆüË°å
npm run quality:gates:dev
npm run quality:gates:prod

# ÁâπÂÆö„Ç≤„Éº„Éà„ÅÆ„ÅøÂÆüË°å
npm run quality:accessibility
npm run quality:coverage

# ÂåÖÊã¨ÁöÑÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØÂÆüË°å
npm run quality:all
```

##### È´òÂ∫¶„Å™‰ΩøÁî®Ê≥ï
```bash
# „Ç´„Çπ„Çø„É†Áí∞Â¢É„Å®„Éï„Çß„Éº„Ç∫
node scripts/run-quality-gates.cjs --env=production --phase=phase-6

# ÁâπÂÆö„Ç≤„Éº„ÉàÁµÑ„ÅøÂêà„Çè„Åõ
node scripts/run-quality-gates.cjs --gates=accessibility,coverage,lighthouse

# „Éò„É´„Éó„Å®„Ç™„Éó„Ç∑„Éß„É≥
node scripts/run-quality-gates.cjs --help
```

#### TypeScriptÁµ±Âêà

```typescript
import { 
  loadQualityPolicy, 
  getQualityGate, 
  shouldEnforceGate,
  validateQualityResults 
} from '../src/utils/quality-policy-loader.js';

// Áí∞Â¢É„Ç™„Éº„Éê„Éº„É©„Ç§„Éâ„Åß„Éù„É™„Ç∑„Éº„Çí„É≠„Éº„Éâ
const policy = loadQualityPolicy('ci');

// ÁâπÂÆö„Ç≤„Éº„ÉàË®≠ÂÆö„ÇíÂèñÂæó
const accessibilityGate = getQualityGate('accessibility', 'ci');

// „Ç≤„Éº„Éà„ÅåÂº∑Âà∂„Åï„Çå„Çã„Åπ„Åç„Åã„ÉÅ„Çß„ÉÉ„ÇØ
const shouldCheck = shouldEnforceGate('accessibility', 'phase-6', 'ci');

// ÈñæÂÄ§„Å´ÂØæ„Åó„Å¶ÁµêÊûú„ÇíÊ§úË®º
const validation = validateQualityResults('accessibility', {
  critical: 0,
  serious: 1,
  moderate: 2
}, 'ci');
```

#### GitHub ActionsÁµ±Âêà

„Ç∑„Çπ„ÉÜ„É†„ÅØGitHub Actions„Å®Ëá™ÂãïÁöÑ„Å´Áµ±Âêà„Åï„Çå„Åæ„ÅôÔºö

```yaml
# ÈõÜÁ¥ÑÂìÅË≥™„Ç≤„Éº„Éà„ÉØ„Éº„ÇØ„Éï„É≠„Éº„Çí‰ΩøÁî®
name: Quality Check
on: [push, pull_request]

jobs:
  quality:
    uses: ./.github/workflows/quality-gates-centralized.yml
    with:
      environment: 'ci'
      phase: 'auto-detect'
      gates: 'all'
```

### ÂÆüË£ÖË©≥Á¥∞

#### „Éù„É™„Ç∑„Éº„É≠„Éº„Éâ„Å®„Ç™„Éº„Éê„Éº„É©„Ç§„Éâ

„Éù„É™„Ç∑„Éº„É≠„Éº„ÉÄ„Éº„ÅØ„Éâ„ÉÉ„ÉàË®òÊ≥ï„Éë„Çπ„Ç∑„Çπ„ÉÜ„É†„Çí‰ΩøÁî®„Åó„Å¶Áí∞Â¢ÉÂõ∫Êúâ„ÅÆ„Ç™„Éº„Éê„Éº„É©„Ç§„Éâ„ÇíÈÅ©Áî®„Åó„Åæ„ÅôÔºö

```json
{
  "environments": {
    "development": {
      "overrides": {
        "accessibility.thresholds.total_warnings": 10,
        "coverage.enforcement": "warn"
      }
    }
  }
}
```

#### „Éï„Çß„Éº„Ç∫Ë™çË≠òÂº∑Âà∂

ÂìÅË≥™„Ç≤„Éº„Éà„ÅØ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´Ë®≠ÂÆö„Åß„Åç„Åæ„ÅôÔºö
1. ÁâπÂÆö„Éï„Çß„Éº„Ç∫„Å´ÈÅ©Áî®: `"phases": ["phase-6"]`
2. ÁâπÂÆö„Éï„Çß„Éº„Ç∫„Åã„ÇâÊúâÂäπÂåñ: `"enabledFromPhase": "phase-3"`
3. „Éï„Çß„Éº„Ç∫Âà∂Èôê„ÅåÂÆöÁæ©„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÂ∏∏„Å´ÈÅ©Áî®

#### „ÉÑ„Éº„É´Áµ±Âêà

##### Lighthouse CI
- „Éù„É™„Ç∑„ÉºÈñæÂÄ§„Å´Âü∫„Å•„ÅèÂãïÁöÑË®≠ÂÆö
- Áí∞Â¢ÉË™çË≠ò„Ç¢„Çµ„Éº„Ç∑„Éß„É≥„É¨„Éô„É´
- Ëá™Âãï„Çπ„Ç≥„Ç¢Â§âÊèõÔºà90 ‚Üí 0.9Ôºâ

##### „Ç´„Éê„É¨„ÉÉ„Ç∏„ÉÑ„Éº„É´
- nyc„Å®vitest„Ç´„Éê„É¨„ÉÉ„Ç∏„ÅÆ‰∏°Êñπ„Çí„Çµ„Éù„Éº„Éà
- Ë®≠ÂÆöÂèØËÉΩ„Å™Èô§Â§ñ„Éë„Çø„Éº„É≥
- Ë§áÊï∞„ÅÆ„É°„Éà„É™„ÇØ„Çπ„Çø„Ç§„ÉóÔºàË°å„ÄÅÈñ¢Êï∞„ÄÅ„Éñ„É©„É≥„ÉÅ„ÄÅ„Çπ„ÉÜ„Éº„Éà„É°„É≥„ÉàÔºâ

##### „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà
- jest-axe„Å®axe-core„Å®„ÅÆÁµ±Âêà
- Â§ö„É¨„Éô„É´ÈÅïÂèçËøΩË∑°
- Ë©≥Á¥∞„Å™Â§±Êïó„É¨„Éù„Éº„Éà

#### „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„Å®„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ

„Ç∑„Çπ„ÉÜ„É†„ÅØÂ†ÖÁâ¢„Å™„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÇíÂê´„Åø„Åæ„ÅôÔºö

1. **„Éù„É™„Ç∑„Éº„É≠„Éº„ÉâÂ§±Êïó**: CLI„Ç¢„Éº„ÇÆ„É•„É°„É≥„Éà„Åæ„Åü„ÅØ„Éá„Éï„Ç©„É´„Éà„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
2. **„ÉÑ„Éº„É´Âà©Áî®‰∏çÂèØ**: Ë≠¶Âëä‰ªò„Åç„ÅßÊ¨†ËêΩ„ÉÑ„Éº„É´„ÅÆ„Ç≤„Éº„Éà„Çí„Çπ„Ç≠„ÉÉ„Éó
3. **„É¨„Éù„Éº„ÉàÁîüÊàê**: ÈñãÁô∫Áí∞Â¢É„ÅßÁ©∫„É¨„Éù„Éº„Éà„Çí‰ΩúÊàê
4. **Áí∞Â¢ÉÊ§úÂá∫**: NODE_ENV„Åã„ÇâÁí∞Â¢É„ÇíËá™ÂãïÊ§úÂá∫

### „Ç´„Çπ„Çø„Éû„Ç§„Ç∫

#### Êñ∞„Åó„ÅÑÂìÅË≥™„Ç≤„Éº„Éà„ÅÆËøΩÂä†

1. **„Éù„É™„Ç∑„ÉºË®≠ÂÆö„ÅÆÊõ¥Êñ∞**:
```json
{
  "quality": {
    "myCustomGate": {
      "description": "„Ç´„Çπ„Çø„É†ÂìÅË≥™„Ç≤„Éº„Éà",
      "enforcement": "strict",
      "thresholds": {
        "customMetric": 90
      },
      "tools": ["custom-tool"],
      "phases": ["phase-4", "phase-5", "phase-6"]
    }
  }
}
```

2. **„Ç≤„Éº„Éà„É©„É≥„Éä„Éº„ÅÆÂÆüË£Ö**:
```javascript
// scripts/run-quality-gates.cjsÂÜÖ„Åß
case 'myCustomGate':
  command = 'npm run custom-check';
  break;
```

3. **NPM„Çπ„ÇØ„É™„Éó„Éà„ÅÆËøΩÂä†**:
```json
{
  "scripts": {
    "quality:custom": "node scripts/run-quality-gates.cjs --gates=myCustomGate"
  }
}
```

#### ÈñæÂÄ§„ÅÆÂ§âÊõ¥

ÂçòÁ¥î„Å´`policy/quality.json`„Éï„Ç°„Ç§„É´„ÇíÊõ¥Êñ∞Ôºö

```json
{
  "quality": {
    "coverage": {
      "thresholds": {
        "lines": 85,        // 80„Åã„ÇâÂ§âÊõ¥
        "functions": 85     // 80„Åã„ÇâÂ§âÊõ¥
      }
    }
  }
}
```

ÂÖ®„Å¶„ÅÆ„ÉÑ„Éº„É´„Å®„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅåËá™ÂãïÁöÑ„Å´Êñ∞„Åó„ÅÑÈñæÂÄ§„Çí‰ΩøÁî®„Åó„Åæ„Åô„ÄÇ

#### Áí∞Â¢ÉÂõ∫Êúâ„ÅÆË™øÊï¥

Áí∞Â¢É„Ç™„Éº„Éê„Éº„É©„Ç§„Éâ„ÇíËøΩÂä†„Åæ„Åü„ÅØÂ§âÊõ¥Ôºö

```json
{
  "environments": {
    "staging": {
      "description": "„Çπ„ÉÜ„Éº„Ç∏„É≥„Ç∞Áí∞Â¢É",
      "overrides": {
        "lighthouse.thresholds.performance": 85,
        "accessibility.enforcement": "warn"
      }
    }
  }
}
```

### „Éô„Çπ„Éà„Éó„É©„ÇØ„ÉÜ„Ç£„Çπ

#### „Éù„É™„Ç∑„ÉºÁÆ°ÁêÜ
1. **„Éê„Éº„Ç∏„Éß„É≥ÁÆ°ÁêÜ**: „Éù„É™„Ç∑„Éº„Éï„Ç°„Ç§„É´„ÇíÂ∏∏„Å´„Éê„Éº„Ç∏„Éß„É≥ÁÆ°ÁêÜ
2. **Â§âÊõ¥„É¨„Éì„É•„Éº**: ÈñæÂÄ§Â§âÊõ¥„Å´ÊâøË™ç„ÇíÂøÖË¶Å„Å®„Åô„Çã
3. **ÊñáÊõ∏Âåñ**: ÈñæÂÄ§„ÅÆÂÄ§„ÅÆÊ†πÊã†„ÇíÊñáÊõ∏Âåñ
4. **ÊÆµÈöéÁöÑÂ§âÊõ¥**: ÈñæÂÄ§„ÅÆÂ¢óÂä†„ÇíÊÆµÈöéÁöÑ„Å´ÂÆüË£Ö

#### ÈñãÁô∫„ÉØ„Éº„ÇØ„Éï„É≠„Éº
1. **„Éó„É¨„Ç≥„Éü„ÉÉ„Éà**: „Ç≥„Éü„ÉÉ„ÉàÂâç„Å´ÂìÅË≥™„Ç≤„Éº„Éà„ÇíÂÆüË°å
2. **„É≠„Éº„Ç´„É´„ÉÜ„Çπ„Éà**: ÂèçÂæ©„Å´ÈñãÁô∫Áí∞Â¢É„Çí‰ΩøÁî®
3. **„Éï„Çß„Éº„Ç∫Ë™çË≠ò**: ÁèæÂú®„ÅÆ„Éï„Çß„Éº„Ç∫„Å´ÈÅ©Áî®„Åï„Çå„Çã„Ç≤„Éº„Éà„ÇíÁêÜËß£
4. **Á∂ôÁ∂öÁõ£Ë¶ñ**: ÂÆöÊúüÁöÑ„Å™ÂìÅË≥™„Ç≤„Éº„ÉàÂÆüË°å

#### CI/CDÁµ±Âêà
1. **„Éû„Éà„É™„ÉÉ„ÇØ„ÇπÊà¶Áï•**: È´òÈÄü„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÅÆ„Åü„ÇÅ„ÅÆ‰∏¶ÂàóÂÆüË°å
2. **„Ç¢„Éº„ÉÜ„Ç£„Éï„Ç°„ÇØ„ÉàÂèéÈõÜ**: ÂàÜÊûê„ÅÆ„Åü„ÇÅ„É¨„Éù„Éº„Éà„Çí‰øùÂ≠ò
3. **Â§±ÊïóÂá¶ÁêÜ**: ÈÅ©Âàá„Å™fail-fast vs. continue-on-error
4. **PR„Ç≥„É°„É≥„Éà**: „Éó„É´„É™„ÇØ„Ç®„Çπ„Éà„Åß„ÅÆËá™Âãï„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ

### „Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞

#### ‰∏ÄËà¨ÁöÑ„Å™ÂïèÈ°å

##### „Éù„É™„Ç∑„Éº„É≠„Éº„ÉâÂ§±Êïó
```bash
‚ö†Ô∏è  Could not load quality policy: ENOENT: no such file or directory
```
**Ëß£Ê±∫ÊñπÊ≥ï**: `policy/quality.json`„ÅåÂ≠òÂú®„Åó„ÄÅÊúâÂäπ„Å™JSON„Åß„ÅÇ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç„ÄÇ

##### „Éï„Çß„Éº„Ç∫Ê§úÂá∫ÂïèÈ°å
```bash
‚ö†Ô∏è  Could not detect current phase, using phase-1
```
**Ëß£Ê±∫ÊñπÊ≥ï**: `.ae/phase-state.json`„Çí‰ΩúÊàê„Åô„Çã„Åã„ÄÅ„Éï„Çß„Éº„Ç∫„ÇíÊòéÁ§∫ÁöÑ„Å´ÊåáÂÆöÔºö
```bash
node scripts/run-quality-gates.cjs --phase=phase-6
```

##### „ÉÑ„Éº„É´Âà©Áî®‰∏çÂèØ
```bash
‚ö†Ô∏è  Lighthouse CI config not found, skipping
```
**Ëß£Ê±∫ÊñπÊ≥ï**: ÂøÖË¶Å„Å™„ÉÑ„Éº„É´„Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åô„Çã„Åã„ÄÅ„Ç≤„Éº„Éà„Çí„Ç™„Éó„Ç∑„Éß„É≥„Å®„Åó„Å¶Ë®≠ÂÆö„ÄÇ

#### „Éá„Éê„ÉÉ„Ç∞„É¢„Éº„Éâ

„Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„ÅÆ„Åü„ÇÅ„Å´Ë©≥Á¥∞„É≠„Ç∞„ÇíÊúâÂäπÂåñÔºö

```bash
DEBUG=quality-gates node scripts/run-quality-gates.cjs --env=development
```

#### ÊâãÂãïÈñæÂÄ§Ê§úË®º

ÂÆåÂÖ®„Å™ÂìÅË≥™„Ç≤„Éº„Éà„ÇíÂÆüË°å„Åõ„Åö„Å´ÁâπÂÆö„ÅÆÈñæÂÄ§„Çí„ÉÜ„Çπ„ÉàÔºö

```bash
# „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£„ÅÆ„Åø„ÉÅ„Çß„ÉÉ„ÇØ
node scripts/check-a11y-threshold.cjs --env=development

# „Ç´„Éê„É¨„ÉÉ„Ç∏„ÅÆ„Åø„ÉÅ„Çß„ÉÉ„ÇØ
node scripts/check-coverage-threshold.cjs --env=ci
```

### „Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥„Ç¨„Ç§„Éâ

#### „Éè„Éº„Éâ„Ç≥„Éº„ÉâÈñæÂÄ§„Åã„Çâ

1. **ÁèæÂú®„ÅÆÈñæÂÄ§„ÇíÁâπÂÆö**: Êó¢Â≠ò„ÅÆ„Çπ„ÇØ„É™„Éó„Éà„Å®„ÉØ„Éº„ÇØ„Éï„É≠„Éº„Çí„É¨„Éì„É•„Éº
2. **„Éù„É™„Ç∑„Éº„Éï„Ç°„Ç§„É´„ÇíÊõ¥Êñ∞**: `policy/quality.json`„Å´ÁèæÂú®„ÅÆÂÄ§„ÇíËøΩÂä†
3. **„Çπ„ÇØ„É™„Éó„Éà„ÇíÊõ¥Êñ∞**: ÈõÜÁ¥Ñ„Éù„É™„Ç∑„Éº„É≠„Éº„ÉÄ„Éº„Çí‰ΩøÁî®„Åô„Çã„Çà„ÅÜ„Å´Â§âÊõ¥
4. **„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥„Çí„ÉÜ„Çπ„Éà**: Êñ∞„Åó„ÅÑ„Ç∑„Çπ„ÉÜ„É†„ÅßÂêå„ÅòÂãï‰Ωú„ÇíÊ§úË®º
5. **„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó**: „Çπ„ÇØ„É™„Éó„Éà„Åã„Çâ„Éè„Éº„Éâ„Ç≥„Éº„ÉâÂÄ§„ÇíÂâäÈô§

#### Ë§áÊï∞Ë®≠ÂÆö„Éï„Ç°„Ç§„É´„Åã„Çâ

1. **Ë®≠ÂÆö„ÇíÁµ±Âêà**: ÈñæÂÄ§„ÇíÂçò‰∏Ä„Éù„É™„Ç∑„Éº„Å´„Éû„Éº„Ç∏
2. **„ÉÑ„Éº„É´Ë®≠ÂÆö„ÇíÊõ¥Êñ∞**: ÈõÜÁ¥Ñ„Éù„É™„Ç∑„Éº„Åã„ÇâË™≠„ÅøËæº„ÇÄ„Çà„ÅÜ„Å´„ÉÑ„Éº„É´„ÇíÂ§âÊõ¥
3. **Áí∞Â¢É„Éû„ÉÉ„Éî„É≥„Ç∞**: Êó¢Â≠ò„ÅÆÁí∞Â¢ÉÂõ∫ÊúâË®≠ÂÆö„Çí„Éû„ÉÉ„Éó
4. **Ê§úË®º**: ÂÖ®„Å¶„ÅÆ„Ç∑„Éä„É™„Ç™„ÅåÊ≠£Â∏∏„Å´Âãï‰Ωú„Åô„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç

### È´òÂ∫¶„Å™Ê©üËÉΩ

#### Êù°‰ª∂‰ªò„ÅçÂº∑Âà∂

„Ç≤„Éº„Éà„ÅØ‰ª•‰∏ã„Å´Âü∫„Å•„ÅÑ„Å¶Êù°‰ª∂‰ªò„Åç„ÅßÂº∑Âà∂„Åß„Åç„Åæ„ÅôÔºö
- „Éï„Ç°„Ç§„É´Â§âÊõ¥ÔºàGitHub Actions„Éë„Çπ„Éï„Ç£„É´„Çø„ÉºÁµåÁî±Ôºâ
- Áí∞Â¢ÉÂ§âÊï∞
- ÈñãÁô∫„Éï„Çß„Éº„Ç∫„ÅÆÈÄ≤Ë°å
- „Ç´„Çπ„Çø„É†„Éì„Ç∏„Éç„Çπ„É≠„Ç∏„ÉÉ„ÇØ

#### „É¨„Éù„Éº„ÉàÁµ±Âêà

„Ç∑„Çπ„ÉÜ„É†„ÅØË§áÊï∞„ÅÆ„É¨„Éù„Éº„ÉàÂΩ¢Âºè„Çí„Çµ„Éù„Éº„ÉàÔºö
- „Éó„É≠„Ç∞„É©„Éû„ÉÜ„Ç£„ÉÉ„ÇØÊ∂àË≤ªÁî®JSON
- ‰∫∫ÈñìÂèØË™≠„É¨„Éù„Éº„ÉàÁî®HTML
- CI/CDÁµ±ÂêàÁî®JUnit XML
- „Éó„É©„Ç∞„Ç§„É≥ÁµåÁî±„ÅÆ„Ç´„Çπ„Çø„É†ÂΩ¢Âºè

#### ÈÄöÁü•„Ç∑„Çπ„ÉÜ„É†

‰ª•‰∏ã„ÅÆÈÄöÁü•„ÇíË®≠ÂÆöÔºö
- ÂìÅË≥™„Ç≤„Éº„ÉàÂ§±Êïó
- ÊâøË™ç„ÅåÂøÖË¶Å„Å™ÈñæÂÄ§Â§âÊõ¥
- „Éà„É¨„É≥„ÉâÂàÜÊûê„Å®Âä£Âåñ„Ç¢„É©„Éº„Éà

„Åì„ÅÆÈõÜÁ¥ÑÂìÅË≥™„Ç≤„Éº„Éà„Ç∑„Çπ„ÉÜ„É†„ÅØ„ÄÅAE-FrameworkÈñãÁô∫„É©„Ç§„Éï„Çµ„Ç§„ÇØ„É´ÂÖ®‰Ωì„ÇíÈÄö„Åò„Å¶‰∏ÄË≤´„Åó„Åü„Ç≥„Éº„ÉâÂìÅË≥™„ÇíÁ∂≠ÊåÅ„Åô„Çã„Åü„ÇÅ„ÅÆÂ†ÖÁâ¢„Å™Âü∫Áõ§„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇ