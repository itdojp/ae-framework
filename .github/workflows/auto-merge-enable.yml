name: Auto-merge Enable

on:
  schedule:
    - cron: "*/30 * * * *"
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  # Prefer github.token; GH_TOKEN allows an explicit PAT when org policies require it.
  contents: write
  pull-requests: write

jobs:
  enable-auto-merge:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node + pnpm
        uses: ./.github/actions/setup-node-pnpm
        with:
          node-version: "20"
      - name: Enable auto-merge when eligible
        env:
          GH_TOKEN: ${{ github.token || secrets.GH_TOKEN }}
        run: node scripts/ci/auto-merge-enabler.mjs
