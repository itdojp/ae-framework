name: CI Fast
on:
  workflow_call:
    # Allow release workflow to reuse this fast CI
    inputs:
      trigger:
        description: 'Origin event name (pull_request/push/workflow_call)'
        required: false
        default: 'workflow_call'
        type: string
      pr_labels:
        description: 'Comma-separated PR labels'
        required: false
        default: ''
        type: string
concurrency:
  group: ci-fast-${{ github.ref }}
  cancel-in-progress: true
permissions: read-all
jobs:
  unit:
    uses: ./.github/workflows/ci-core.yml
    with:
      node-version: '20'
      run-script: test:unit
  fast:
    uses: ./.github/workflows/ci-core.yml
    with:
      node-version: '20'
      run-script: test:fast
  fast-commands:
    if: ${{ (inputs.trigger || github.event_name) != 'pull_request' || contains(inputs.pr_labels, 'qa-batch:commands') }}
    uses: ./.github/workflows/ci-core.yml
    with:
      node-version: '20'
      run-script: test:fast:batch:commands
  fast-cli:
    if: ${{ (inputs.trigger || github.event_name) != 'pull_request' || contains(inputs.pr_labels, 'qa-batch:cli') }}
    uses: ./.github/workflows/ci-core.yml
    with:
      node-version: '20'
      run-script: test:fast:batch:cli
  fast-property:
    if: ${{ (inputs.trigger || github.event_name) != 'pull_request' || contains(inputs.pr_labels, 'qa-batch:property') }}
    uses: ./.github/workflows/ci-core.yml
    with:
      node-version: '20'
      run-script: test:fast:batch:property
  fast-agents:
    if: ${{ (inputs.trigger || github.event_name) != 'pull_request' || contains(inputs.pr_labels, 'qa-batch:agents') }}
    uses: ./.github/workflows/ci-core.yml
    with:
      node-version: '20'
      run-script: test:fast:batch:agents
  lint:
    uses: ./.github/workflows/ci-core.yml
    with:
      node-version: '20'
      run-script: lint
